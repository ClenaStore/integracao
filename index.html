<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Recebimentos Mercatto</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body{font-family:Arial, sans-serif;background:#f8fafc;margin:0;color:#1e293b}
    header{background:#1e40af;color:#fff;text-align:center;padding:16px;font-size:1.4em;font-weight:bold}
    main{max-width:800px;margin:30px auto;padding:20px;background:#fff;border-radius:10px;box-shadow:0 4px 16px rgba(0,0,0,.1)}
    .filtros{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-bottom:20px}
    .filtros input{padding:8px;border:1px solid #cbd5e1;border-radius:6px}
    button{background:#2563eb;color:white;border:none;padding:10px 20px;border-radius:6px;cursor:pointer}
    #overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(255,255,255,.8);z-index:999;justify-content:center;align-items:center;font-size:1.5em;color:#2563eb;font-weight:bold}
    .erro{text-align:center;color:red;margin-top:20px}
    .resultado{margin-top:20px}
  </style>
</head>
<body>
  <header>üìä Recebimentos Mercatto</header>
  <main>
    <div class="filtros">
      <input type="date" id="dataInicial">
      <input type="time" id="horaInicial" value="08:00">
      <input type="date" id="dataFinal">
      <input type="time" id="horaFinal" value="23:59">
      <button onclick="buscar()">Buscar</button>
    </div>
    <div id="overlay">‚è≥ Processando...</div>
    <div id="erro" class="erro"></div>
    <div id="resultado" class="resultado"></div>
  </main>

  <script>
    async function buscar(){
      const dataInicial = document.getElementById("dataInicial").value;
      const dataFinal = document.getElementById("dataFinal").value;
      const horaInicial = document.getElementById("horaInicial").value;
      const horaFinal = document.getElementById("horaFinal").value;
      const overlay = document.getElementById("overlay");
      const erro = document.getElementById("erro");
      const resultado = document.getElementById("resultado");

      overlay.style.display = "flex";
      erro.textContent = ""; resultado.innerHTML = "";

      try{
        const res = await fetch(`/api/recebimentos?dataInicial=${dataInicial}&horaInicial=${horaInicial}&dataFinal=${dataFinal}&horaFinal=${horaFinal}`);
        const data = await res.json();
        if(!res.ok) throw new Error(data.error || "Erro na API");

        let html = `<h3>Total de Cupons: ${data.total}</h3>`;
        data.items.forEach(cupom=>{
          html += `<div>üí∞ <b>${cupom.valor.toFixed(2)}</b> ‚Äî Caixa ${cupom.numeroCaixa} ‚Äî ${new Date(cupom.dataHoraFechamentoCupom).toLocaleString()}</div>`;
        });
        resultado.innerHTML = html;
      }catch(e){
        erro.textContent = e.message;
      }finally{
        overlay.style.display = "none";
      }
    }

    const hoje = new Date().toISOString().split("T")[0];
    document.getElementById("dataInicial").value = hoje;
    document.getElementById("dataFinal").value = hoje;
  </script>
</body>
</html>
