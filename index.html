<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Recebimentos PDV ‚Ä¢ Mercatto</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body{
    background:#0b1220;color:#e5f0ff;
    font-family:Inter,system-ui;
    display:flex;flex-direction:column;align-items:center;
    padding:20px;
  }
  input,button{
    margin:5px;padding:8px;border-radius:6px;
    border:none;font-size:14px;
  }
  button{background:#06b6d4;color:white;cursor:pointer;}
  pre{
    background:#111a2e;padding:20px;border-radius:8px;
    max-width:90vw;overflow:auto;
    color:#00ffaa;
    font-size:12px;
  }
</style>
</head>
<body>
  <h1>Consulta Recebimentos Mercatto</h1>
  <div>
    <input type="date" id="dataInicio">
    <input type="time" id="horaInicio" value="00:00">
    <input type="date" id="dataFim">
    <input type="time" id="horaFim" value="23:59">
    <button onclick="consultar()">Consultar</button>
  </div>
  <pre id="saida">Aguardando consulta...</pre>

<script>
async function consultar(){
  document.getElementById('saida').innerText = "üîÑ Autenticando...";
  try{
    // 1Ô∏è‚É£ Login -> obt√©m accessToken
    const loginResp = await fetch('/api/login', { method:'POST' });
    const loginData = await loginResp.json();
    const token = loginData.accessToken;
    if(!token) throw new Error("Token n√£o recebido");

    // 2Ô∏è‚É£ Pega valores de data/hora
    const dataInicio = document.getElementById('dataInicio').value;
    const dataFim = document.getElementById('dataFim').value;
    const horaInicio = document.getElementById('horaInicio').value;
    const horaFim = document.getElementById('horaFim').value;

    document.getElementById('saida').innerText = "üîÑ Buscando vendas...";

    // 3Ô∏è‚É£ Consulta vendas
    const resp = await fetch('/api/recebimentos', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ token, dataInicio, dataFim, horaInicio, horaFim })
    });
    const data = await resp.json();

    // 4Ô∏è‚É£ Exibe JSON puro
    document.getElementById('saida').innerText = JSON.stringify(data, null, 2);

  }catch(e){
    console.error(e);
    document.getElementById('saida').innerText = "Erro: " + e.message;
  }
}
</script>
</body>
</html>
