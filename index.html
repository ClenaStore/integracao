<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recebimentos Mercatto</title>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/4727/4727490.png">
  <style>
    :root {
      --bg:#f6f8fb; --card:#fff; --text:#0f172a; --muted:#64748b;
      --brand:#1d4ed8; --ok:#16a34a; --error:#ef4444; --radius:14px;
      --shadow:0 4px 16px rgba(0,0,0,0.1);
    }
    body {
      margin:0; font-family:Inter,system-ui,Arial;
      background:var(--bg); color:var(--text);
    }
    header {
      background:var(--brand); color:white; padding:14px;
      text-align:center; font-weight:600; font-size:1.2rem;
      display:flex; align-items:center; justify-content:center; gap:8px;
    }
    header img { height:22px; }
    main {
      max-width:900px; margin:40px auto; background:var(--card);
      padding:30px; border-radius:var(--radius); box-shadow:var(--shadow);
      text-align:center;
    }
    .inputs { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-bottom:20px; }
    input, button {
      padding:10px 14px; border-radius:var(--radius); border:1px solid #d1d5db;
      font-size:15px;
    }
    button {
      background:var(--brand); color:white; border:none; cursor:pointer; font-weight:600;
      transition:.2s;
    }
    button:hover { opacity:0.9; }
    .msg { color:var(--error); margin-bottom:12px; font-weight:600; }
    .cards {
      display:grid; grid-template-columns:1fr 1fr; gap:20px; justify-items:center;
    }
    .card {
      background:var(--card); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:30px; width:100%;
      max-width:380px; text-align:center;
    }
    .valor { font-size:2rem; color:var(--ok); font-weight:700; margin-top:10px; }
  </style>
</head>
<body>
  <header>
    <img src="https://cdn-icons-png.flaticon.com/512/4727/4727490.png" />
    Recebimentos Mercatto
  </header>
  <main>
    <div class="inputs">
      <div>
        <label>Data Inicial:</label><br>
        <input type="date" id="dataInicial" />
      </div>
      <div>
        <label>Hora Inicial:</label><br>
        <input type="time" id="horaInicial" value="08:00" />
      </div>
      <div>
        <label>Data Final:</label><br>
        <input type="date" id="dataFinal" />
      </div>
      <div>
        <label>Hora Final:</label><br>
        <input type="time" id="horaFinal" value="23:59" />
      </div>
      <div>
        <button id="filtrar">Buscar</button>
      </div>
    </div>
    <div id="mensagem" class="msg"></div>
    <div class="cards">
      <div class="card">
        <h3>CARNEIRO MERCATTO RESTAURANTE</h3>
        <div id="restaurante" class="valor">R$ 0,00</div>
      </div>
      <div class="card">
        <h3>CARNEIRO MERCATTO EMPÃ“RIO</h3>
        <div id="emporio" class="valor">R$ 0,00</div>
      </div>
    </div>
  </main>

  <script type="module">
    import { loginVarejo } from './api/login.js';
    import { buscarRecebimentos } from './api/recebimentos.js';

    document.getElementById('filtrar').addEventListener('click', async () => {
      const dataInicial = document.getElementById('dataInicial').value;
      const horaInicial = document.getElementById('horaInicial').value;
      const dataFinal = document.getElementById('dataFinal').value;
      const horaFinal = document.getElementById('horaFinal').value;
      const msg = document.getElementById('mensagem');
      msg.textContent = '';

      if (!dataInicial || !dataFinal) {
        msg.textContent = 'Informe as datas corretamente.';
        return;
      }

      msg.textContent = 'Carregando...';

      try {
        const token = await loginVarejo();
        if (!token) throw new Error('Falha no login');

        const dados = await buscarRecebimentos(token, dataInicial, horaInicial, dataFinal, horaFinal);

        if (!dados || !dados.items) {
          msg.textContent = 'Nenhum dado encontrado.';
          return;
        }

        // exemplo: soma valores por lojaId
        const totalRestaurante = dados.items.filter(i => i.lojaId === 1).reduce((acc, i) => acc + i.valor, 0);
        const totalEmporio = dados.items.filter(i => i.lojaId === 2).reduce((acc, i) => acc + i.valor, 0);

        document.getElementById('restaurante').textContent = totalRestaurante.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
        document.getElementById('emporio').textContent = totalEmporio.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
        msg.textContent = '';
      } catch (err) {
        msg.textContent = 'Erro: ' + err.message;
      }
    });
  </script>
</body>
</html>
